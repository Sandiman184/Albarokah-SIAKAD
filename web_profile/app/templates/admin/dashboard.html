{% extends "admin/layout.html" %}

{% block content %}
<style>
    /* Dashboard Specific Styles */
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #064e36 100%);
        color: white;
        padding: 2.5rem 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        position: relative;
        overflow: hidden;
    }
    
    .dashboard-header::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 300px;
        height: 100%;
        background: url("{{ url_for('static', filename='img/logo.png') }}") no-repeat center center;
        background-size: contain;
        opacity: 0.1;
        transform: translate(30%, 0);
    }

    .stats-card {
        border: none;
        border-radius: 1rem;
        transition: all 0.3s ease;
        overflow: hidden;
        position: relative;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 2rem 0 rgba(58, 59, 69, 0.25);
    }
    
    .stats-card .card-body {
        padding: 1.5rem;
        z-index: 1;
        position: relative;
    }
    
    .stats-icon-bg {
        position: absolute;
        right: -10px;
        top: -10px;
        font-size: 6rem;
        opacity: 0.2;
        transform: rotate(15deg);
        z-index: 0;
        transition: all 0.3s ease;
    }

    .stats-card:hover .stats-icon-bg {
        transform: rotate(0deg) scale(1.1);
        opacity: 0.3;
    }

    /* Distinct Gradients */
    .bg-gradient-emerald { 
        background: linear-gradient(135deg, #043927 0%, #157a53 100%); 
        color: white; 
    }
    .bg-gradient-gold { 
        background: linear-gradient(135deg, #b48b1d 0%, #dda20a 100%); 
        color: white; 
    }
    .bg-gradient-blue { 
        background: linear-gradient(135deg, #4e73df 0%, #224abe 100%); 
        color: white; 
    }
    .bg-gradient-red { 
        background: linear-gradient(135deg, #e74a3b 0%, #be2617 100%); 
        color: white; 
    }

    /* Quick Actions Grid */
    .quick-action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        border-radius: 1rem;
        background-color: #fff;
        border: 1px solid #e3e6f0;
        transition: all 0.3s ease;
        height: 100%;
        text-align: center;
        color: #5a5c69;
    }
    .quick-action-btn:hover {
        background-color: #f8f9fa;
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        text-decoration: none;
        color: var(--primary-color);
    }
    .quick-action-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: var(--primary-color);
    }
    .quick-action-btn:hover .quick-action-icon {
        color: var(--accent-color);
    }
</style>

<!-- Welcome Header -->
<div class="dashboard-header d-flex align-items-center justify-content-between">
    <div>
        <h1 class="h3 mb-2 font-weight-bold">Selamat Datang, {{ current_user.username|title }}!</h1>
        <p class="mb-0 opacity-75">Berikut adalah ringkasan aktivitas di Website Ponpes Al-Barokah.</p>
    </div>
    <div class="text-end d-none d-md-block">
        <h5 class="mb-0 text-white">{{ now().strftime('%d %B %Y') }}</h5>
        <small class="opacity-75 text-white"><i class="fas fa-clock me-1"></i> Update Terakhir: {{ now().strftime('%H:%M') }} WIB</small>
    </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <!-- Berita Card -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card bg-gradient-emerald h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col mr-2">
                        <div class="text-uppercase small font-weight-bold mb-1 opacity-75">Total Berita</div>
                        <div class="h2 mb-0 font-weight-bold">{{ total_berita }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-newspaper fa-2x opacity-75"></i>
                    </div>
                </div>
                <i class="fas fa-newspaper stats-icon-bg"></i>
            </div>
        </div>
    </div>

    <!-- Agenda Card -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card bg-gradient-gold h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col mr-2">
                        <div class="text-uppercase small font-weight-bold mb-1 opacity-75">Agenda</div>
                        <div class="h2 mb-0 font-weight-bold">{{ total_agenda }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-calendar-check fa-2x opacity-75"></i>
                    </div>
                </div>
                <i class="fas fa-calendar-check stats-icon-bg"></i>
            </div>
        </div>
    </div>

    <!-- Galeri Card -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card bg-gradient-blue h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col mr-2">
                        <div class="text-uppercase small font-weight-bold mb-1 opacity-75">Galeri Foto</div>
                        <div class="h2 mb-0 font-weight-bold">{{ total_galeri }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-images fa-2x opacity-75"></i>
                    </div>
                </div>
                <i class="fas fa-images stats-icon-bg"></i>
            </div>
        </div>
    </div>

    <!-- Program Card -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card bg-gradient-red h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col mr-2">
                        <div class="text-uppercase small font-weight-bold mb-1 opacity-75">Program</div>
                        <div class="h2 mb-0 font-weight-bold">{{ total_program }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-graduation-cap fa-2x opacity-75"></i>
                    </div>
                </div>
                <i class="fas fa-graduation-cap stats-icon-bg"></i>
            </div>
        </div>
    </div>
</div>

<!-- Content Row -->
<div class="row">
    <!-- Analytics Chart -->
    <div class="col-12 mb-4">
        <div class="card shadow-sm border-0">
            <div class="card-header py-3 bg-white d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-chart-line me-2"></i>Statistik Konten</h6>
            </div>
            <div class="card-body">
                <div class="chart-area" style="height: 300px;">
                    <canvas id="contentChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Main Content: Recent News -->
    <div class="col-lg-8 mb-4">
        <div class="card shadow-sm border-0 mb-4 h-100">
            <div class="card-header py-3 bg-white d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-success"><i class="fas fa-newspaper me-2"></i>Berita Terbaru</h6>
                <a href="{{ url_for('admin.berita_list') }}" class="btn btn-sm btn-light rounded-pill text-success fw-bold">Lihat Semua</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-items-center mb-0">
                        <thead class="bg-light text-muted">
                            <tr>
                                <th class="border-0">Judul</th>
                                <th class="border-0">Tanggal</th>
                                <th class="border-0">Status</th>
                                <th class="border-0 text-end">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for berita in recent_berita %}
                            <tr>
                                <td class="fw-bold text-dark text-truncate" style="max-width: 250px;">
                                    {{ berita.judul }}
                                </td>
                                <td class="text-muted small">
                                    <i class="far fa-calendar me-1"></i> {{ berita.tanggal.strftime('%d/%m/%Y') }}
                                </td>
                                <td>
                                    {% if berita.status == 'published' %}
                                    <span class="badge bg-success-subtle text-success rounded-pill px-3">Published</span>
                                    {% else %}
                                    <span class="badge bg-secondary-subtle text-secondary rounded-pill px-3">Draft</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <a href="{{ url_for('admin.berita_edit', id=berita.id) }}" class="btn btn-sm btn-light text-primary rounded-circle" title="Edit">
                                        <i class="fas fa-pencil-alt"></i>
                                    </a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center py-5">
                                    <div class="text-muted opacity-50 mb-2"><i class="fas fa-inbox fa-3x"></i></div>
                                    <p class="text-muted small">Belum ada berita yang dipublish.</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Content -->
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header py-3 bg-white">
                <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-bolt me-2"></i>Aksi Cepat</h6>
            </div>
            <div class="card-body p-3">
                <div class="row g-3">
                    <div class="col-6 mb-3">
                        <a href="{{ url_for('admin.berita_add') }}" class="quick-action-btn">
                            <i class="fas fa-pen quick-action-icon"></i>
                            <span class="small fw-bold">Tulis Berita</span>
                        </a>
                    </div>
                    <div class="col-6 mb-3">
                        <a href="{{ url_for('admin.agenda_add') }}" class="quick-action-btn">
                            <i class="fas fa-calendar-plus quick-action-icon"></i>
                            <span class="small fw-bold">Agenda Baru</span>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{{ url_for('admin.galeri_add') }}" class="quick-action-btn">
                            <i class="fas fa-camera quick-action-icon"></i>
                            <span class="small fw-bold">Upload Foto</span>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{{ url_for('admin.program_add') }}" class="quick-action-btn">
                            <i class="fas fa-graduation-cap quick-action-icon"></i>
                            <span class="small fw-bold">Program Baru</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Agenda -->
        <div class="card shadow-sm border-0">
            <div class="card-header py-3 bg-white d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-warning"><i class="fas fa-clock me-2"></i>Agenda Dekat</h6>
                <a href="{{ url_for('admin.agenda_list') }}" class="text-warning small fw-bold text-decoration-none">Semua <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="card-body p-0">
                {% if upcoming_agenda %}
                    <ul class="list-group list-group-flush">
                        {% for agenda in upcoming_agenda %}
                        <li class="list-group-item px-4 py-3 border-light">
                            <div class="d-flex align-items-center">
                                <div class="bg-warning-subtle text-warning rounded-3 text-center p-2 me-3" style="min-width: 50px;">
                                    <span class="d-block h5 mb-0 fw-bold">{{ agenda.tanggal_mulai.strftime('%d') }}</span>
                                    <span class="d-block small text-uppercase">{{ agenda.tanggal_mulai.strftime('%b') }}</span>
                                </div>
                                <div class="flex-grow-1 overflow-hidden">
                                    <h6 class="mb-1 text-dark fw-bold text-truncate">{{ agenda.nama_kegiatan }}</h6>
                                    <small class="text-muted d-block text-truncate"><i class="fas fa-map-marker-alt me-1"></i> {{ agenda.lokasi }}</small>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="text-center py-5 text-muted">
                        <i class="far fa-calendar-times fa-3x mb-3 opacity-25"></i>
                        <p class="small m-0">Tidak ada agenda dalam waktu dekat.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Set new default font family and font color to mimic Bootstrap's default styling
    Chart.defaults.font.family = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.color = '#858796';

    var ctx = document.getElementById("contentChart");
    var myBarChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["Berita", "Agenda", "Galeri", "Program"],
            datasets: [{
                label: "Jumlah Data",
                backgroundColor: ["#1cc88a", "#f6c23e", "#36b9cc", "#4e73df"],
                hoverBackgroundColor: ["#17a673", "#dda20a", "#2c9faf", "#2e59d9"],
                borderColor: "#4e73df",
                data: [{{ total_berita }}, {{ total_agenda }}, {{ total_galeri }}, {{ total_program }}],
                borderRadius: 5,
                barPercentage: 0.5,
            }],
        },
        options: {
            maintainAspectRatio: false,
            layout: {
                padding: {
                    left: 10,
                    right: 25,
                    top: 25,
                    bottom: 0
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        maxTicksLimit: 6
                    }
                },
                y: {
                    ticks: {
                        min: 0,
                        maxTicksLimit: 5,
                        padding: 10,
                        callback: function(value) { return value; }
                    },
                    grid: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                    }
                },
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: "rgb(255,255,255)",
                    bodyColor: "#858796",
                    titleColor: '#6e707e',
                    borderColor: '#dddfeb',
                    borderWidth: 1,
                    padding: 15,
                    displayColors: false,
                    intersect: false,
                    mode: 'index',
                    caretPadding: 10,
                }
            }
        }
    });
</script>
{% endblock %}